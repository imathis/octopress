
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>James Ottaway</title>
  <meta name="author" content="James Ottaway">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://blog.james.ottaway.mp/index.html"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="James Ottaway" type="application/atom+xml"/>
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">James Ottaway</a></h1>
  
    <h2>Musings of a criminally-insane software developer</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:blog.james.ottaway.mp" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2011/09/22/bootstrapping-personal-babushka-deps/">Bootstrapping Personal Babushka Deps</a></h1>
    
    
      <p class="meta">





  



<time datetime="2011-09-22T08:10:00+10:00" pubdate  data-updated="true" >Sep 22<span>nd</span>, 2011</time></p>
    
  </header>


  <div class="entry-content"><p>I have recently been pushing the envelope of what I use <a href="http://babushka.me/">Babushka</a> towards the vicinity of provisioning everything I need for my personal and work machines. To this effect, I am running Babushka on fresh installs of both OS X Lion and Ubuntu 11.04.</p>

<p>As you can imagine, the first thing I do is install Babushka. That all works great, but my next step is to run something like <code>babushka dev-natty</code>. Unfortunately, this fresh machine doesn&#8217;t have my personal deps on it, and I don&#8217;t want to keep running all of my personal deps like <code>babushka jamesottaway:dev-natty</code></p>

<p>I could go and create a new public/private SSH key pair, log into Github, give it my new public key, and then clone by <code>babushka-deps</code> repo. But why can&#8217;t Babushka do it for me?</p>

<p>The solution is to write a few deps that manage those steps above, and which I can run by prefixing my Github username to the dep (ie. <code>babushka jamesottaway:bootstrap</code>). If you aren&#8217;t familiar with this convention in Babushka, read the <a href="http://babushka.me/sharing">Sharing</a> page to understand what I mean.</p>

<p>The first dep ensures that I have a public/private key pair.</p>

<div><script src='https://gist.github.com/1234192.js?file=ssh.rb'></script>
<noscript><pre><code>dep 'ssh keys' do
  setup { define_var :ssh_dir, :message =&gt; 'Where do your SSH keys live? ', :default =&gt; '~/.ssh' }
  met? { (var(:ssh_dir) / 'id_rsa.pub').exists? &amp;&amp; (var(:ssh_dir) / 'id_rsa').exists? }
  prepare { define_var :ssh_password, :message =&gt; 'What passphrase do you want to encrypt your SSH keys with?' }
  meet { shell &quot;ssh-keygen -t rsa -N #{var :ssh_password} -f #{var :ssh_dir}/id_rsa&quot; }
end</code></pre></noscript></div>


<p>The next dep ensures I can push and pull from Github.</p>

<div><script src='https://gist.github.com/1234192.js?file=github.rb'></script>
<noscript><pre><code>dep 'github has my public key' do
  requires 'ssh keys'
  define_var :github_username, :message =&gt; 'What is your GitHub username?'
  define_var :github_password, :message =&gt; 'What is your GitHub password?'
  met? { raw_shell('ssh -T git@github.com 2&gt;&amp;1').stdout['successfully authenticated'] }
  prepare {
    set :hostname, shell('hostname')
    set :public_key, shell('cat ~/.ssh/id_rsa.pub')
    set :github_api, 'https://api.github.com'
  }
  meet {
    auth = &quot;#{var :github_username}:#{var :github_password}&quot;
    args = &quot;{\&quot;title\&quot;: \&quot;#{var :hostname}\&quot;, \&quot;key\&quot;: \&quot;#{var :public_key}\&quot;}&quot;
    shell &quot;curl -u '#{auth}' -d '#{args}' #{var :github_api}/user/keys&quot;
  }
end</code></pre></noscript></div>


<p>And the final dep will clone my Babushka deps repo into <code>~/.babushka/deps</code>, as well as alias the main dep to give it a shorter name.</p>

<div><script src='https://gist.github.com/1234192.js?file=bootstrap.rb'></script>
<noscript><pre><code>dep 'babushka deps cloned' do
  requires 'github has my public key'
  setup {
    set :babushka_deps_dir, '~/.babushka/deps'.to_fancypath
    define_var :github_username, :message =&gt; 'What is your GitHub username?'
    define_var :babushka_deps_repo_name, :message =&gt; 'What is your Babushka deps repo called?', :default =&gt; 'babushka-deps'
    set :babushka_deps_repo, &quot;git@github.com:#{var :github_username}/#{var :babushka_deps_repo_name}.git&quot;
  }
  met? { var(:babushka_deps_dir).directory? &amp;&amp; shell(&quot;(cd #{var :babushka_deps_dir} &amp;&amp; git remote -v)&quot;)[var :babushka_deps_repo] }
  meet { shell &quot;git clone #{var :babushka_deps_repo} #{var :babushka_deps_dir}&quot; }
end

dep 'bootstap' do
  requires 'babushka deps cloned'
end</code></pre></noscript></div>


<p>The end result: <code>babushka jamesottaway:bootstrap</code> will get me up and ready to edit and run my personal deps without any further messing around.</p>
</div>
  
  


  </article>

<nav role="pagination">
  <div>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</nav>

</div>
<aside role=sidebar>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/09/22/bootstrapping-personal-babushka-deps/">Bootstrapping Personal Babushka Deps</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - James Ottaway -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25898175-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
